const{launcher}=require("../server/app/index"),iconTool=require("./util/file-icon"),config=require("./util/config"),shareList=require("./util/share-list"),network=require("./util/network"),utools=window.utools,shell={openInDirectory:function(o){utools.shellShowItemInFolder(o)},selectDirectory:function(){return utools.showOpenDialog({title:"选择文件夹",defaultPath:utools.getPath("downloads"),buttonLabel:"选择文件夹",properties:["openDirectory","createDirectory"]})}},clipboard={copyText:function(o){return utools.copyText(o)}};utools.onPluginEnter((({code:o,type:e,payload:t,optional:n})=>{if(console.log("用户进入插件"),console.log("code:",o),console.log("type:",e),console.log("payload:",t),console.log("optional:",n),"94434e14-778b-417d-8fd5-392f70d14293"===o)if("files"===e){const o=[];for(const e of t){const t={fileName:e.name,filePath:e.path};t.icon=iconTool.getIconForFileName(e.name),console.log("item:",t),o.push(t)}o.length>1?shareList.addAll(o):1===o.length&&shareList.addItem(o[0]),console.log("服务器的状态",launcher.isRunning()?"运行中":"未运行"),launcher.isRunning()||setTimeout((()=>{launcher.start(config.getPort())}),100)}else shareList.triggerListUpdate()})),document.addEventListener("visibilitychange",(function(){document.hidden&&!window.preventPluginOut&&(utools.outPlugin(),console.log("退出插件."))})),window.pluginApi={shell,clipboard,server:launcher,config,shareList,network};