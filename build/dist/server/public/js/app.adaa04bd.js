!function(t){function e(e){for(var o,i,s=e[0],l=e[1],c=e[2],d=0,p=[];d<s.length;d++)i=s[d],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&p.push(a[i][0]),a[i]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(t[o]=l[o]);for(u&&u(e);p.length;)p.shift()();return r.push.apply(r,c||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],o=!0,s=1;s<n.length;s++){var l=n[s];0!==a[l]&&(o=!1)}o&&(r.splice(e--,1),t=i(i.s=n[0]))}return t}var o={},a={app:0},r=[];function i(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=o,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="";var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var u=l;r.push([0,"chunk-vendors"]),n()}({0:function(t,e,n){t.exports=n("56d7")},"38c3":function(t,e,n){},"452c":function(t,e,n){},"4a28":function(t,e,n){"use strict";n("38c3")},"56d7":function(t,e,n){"use strict";n.r(e),n("e260"),n("e6cf"),n("cca6"),n("a79d");var o=n("2b0e"),a=(n("a15b"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("v-list",[n("v-list-item-group",{attrs:{color:"primary"}},t._l(t.items,(function(e,o){return n("div",{key:o},[n("v-list-item",{on:{click:function(){return t.download(e.url)}}},[n("v-list-item-icon",[n("v-icon",{domProps:{textContent:t._s(e.icon)}})],1),n("v-list-item-content",[n("v-list-item-title",{domProps:{textContent:t._s(e.fileName)}})],1),n("v-list-item-action",[n("v-icon",[t._v("mdi-download")])],1)],1),n("v-divider")],1)})),0)],1)],1)}),r=(n("d81d"),n("d3b7"),n("2ca0"),n("bc3a")),i=n.n(r);i.a.defaults.baseURL=window.location.origin,i.a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded";var s=i.a;function l(){return new Promise((function(t,e){s.get("/auth/auth-config").then((function(n){if(200!==n.status)e(new Error(n.statusText));else{var o=n.data;t(o.requireAuth)}})).catch(e)}))}var c={name:"ShareList",data:function(){return{items:[]}},created:function(){this.loadData()},methods:{loadData:function(){var t=this;l().then((function(e){return e?sessionStorage.getItem("password")?Promise.resolve(sessionStorage.getItem("password")):t.$requirePassword():Promise.resolve()})).catch((function(t){console.log(t.message)})).then((function(t){return sessionStorage.setItem("password",t),function(t){return new Promise((function(e,n){var o={headers:{token:btoa(t)}};s.post("/shares",{},o).then((function(t){if(200!==t.status)n(new Error(t.statusText));else{var o=t.data;e(o)}})).catch(n)}))}(t)})).then((function(e){t.$data.items=e})).catch((function(e){sessionStorage.setItem("password",""),t.$showError(e.message)}))},download:function(t){window.open(t)},getAllDownloadUrl:function(){for(var t=this.items.map((function(t){return t.url})),e=0;e<t.length;++e){var n=t[e];if(!n.startsWith("http://")){var o=window.location.origin;t[e]=o+n}}return t}}},u=n("2877"),d=n("6544"),p=n.n(d),f=n("ce7e"),h=n("132d"),v=n("8860"),m=n("da13"),w=n("1800"),g=n("5d23"),b=n("1baa"),y=n("34c3"),x=Object(u.a)(c,a,[],!1,null,null,null),k=x.exports;p()(x,{VDivider:f.a,VIcon:h.a,VList:v.a,VListItem:m.a,VListItemAction:w.a,VListItemContent:g.a,VListItemGroup:b.a,VListItemIcon:y.a,VListItemTitle:g.c});var _=(n("99af"),n("b0c0"),n("d4ec")),T=n("bee2"),C="待上传",V="上传中",P="已终止",$="已完成",I=function(){function t(){Object(_.a)(this,t),this.status=C,this.onUploadProgress=null,this.password=null,this.source=s.CancelToken.source()}return Object(T.a)(t,[{key:"upload",value:function(t){var e=new FormData;return e.append("file",t),s.put("/files",e,{headers:{token:btoa(this.password)},onUploadProgress:this.onUploadProgress})}},{key:"cancel",value:function(){this.source.cancel("用户取消上传")}}]),t}(),O=(n("b680"),n("4128")),S=n.n(O),E=new S.a("1024"),B=new S.a("1048576"),D=new S.a("1073741824"),F=new S.a("1099511627776");function L(t){return new S.a(t).div(E)}function U(t){return new S.a(t).div(B)}function j(t){return new S.a(t).div(D)}var A={chooseTheMostSuitableUnit:function(t){return(t=new S.a(t)).lessThan(E)?"Byte":t.greaterThanOrEqualTo(E)&&t.lessThan(B)?"KB":t.greaterThanOrEqualTo(B)&&t.lessThan(D)?"MB":t.greaterThanOrEqualTo(D)?"GB":"TB"},toHumanFriendlyFormat:function(t){return(t=new S.a(t)).lessThan(E)?"".concat(t,"Byte"):t.greaterThanOrEqualTo(E)&&t.lessThan(B)?"".concat(L(t).toFixed(2),"KB"):t.greaterThanOrEqualTo(B)&&t.lessThan(D)?"".concat(U(t).toFixed(2),"MB"):t.greaterThanOrEqualTo(D)?"".concat(j(t).toFixed(2),"GB"):"".concat(function(t){return new S.a(t).div(F)}(t).toFixed(2),"TB")},toGB:j,toMB:U,toKB:L},M={name:"FileUpload",data:function(){return{upload:{displayDialog:!1,items:[],password:""}}},methods:{selectFiles:function(){var t=this.$refs.fileInput,e=this;return new Promise((function(n){t.value="",t.click(),t.addEventListener("change",(function(){e.appendItems(t.files),t.value="",n(e.upload.items)}))}))},appendItems:function(t){for(var e=0;e<t.length;++e){var n=this.getProgressText(0,t[e].size);this.upload.items.push({file:t[e],icon:"mdi-file",fileName:t[e].name,size:t[e].size,uploadProgressText:n,uploadProgress:0,uploader:null,status:C})}},uploadFiles:function(){var t=this,e=this;l().then((function(t){return t&&!sessionStorage.getItem("password")?e.$requirePassword():Promise.resolve(sessionStorage.getItem("password"))})).then((function(t){return sessionStorage.setItem("password",t),e.upload.password=t,Promise.resolve(t)})).then((function(t){return function(t){return new Promise((function(e,n){s.post("/auth/validate",{},{headers:{token:btoa(t)}}).then(e).catch((function(t){if(403!==t.response.status)n(new Error(t.message));else{var e=t.message+". wrong password!";n(new Error(e))}}))}))}(t)})).catch((function(t){return e.upload.items=[],sessionStorage.setItem("password",""),Promise.reject(t)})).then((function(){e.upload.displayDialog=!0;for(var n=0;n<t.upload.items.length;++n){t.upload.items[n].status===C&&t.uploadFile(n)}})).catch((function(t){e.$showError(t.message)}))},uploadFile:function(t){var e=this.upload.items[t];e.status=V,e.uploader=new I;var n=this;e.uploader.onUploadProgress=function(t){if(t.lengthComputable){var o=new S.a(t.loaded),a=new S.a(t.total);e.uploadProgressText=n.getProgressText(t.loaded,t.total),e.uploadProgress=o.div(a).mul(100).toNumber(),o.equals(a)&&(e.status=$)}},e.uploader.password=n.upload.password,e.uploader.upload(e.file).catch((function(t){n.$showError(t.message),e.status=P}))},cancel:function(){for(var t=0;t<this.upload.items.length;++t){var e=this.upload.items[t];e.status===V&&(e.uploader.cancel(),e.status=P)}this.upload.items=[],this.upload.displayDialog=!1},getProgressText:function(t,e){var n=A.toHumanFriendlyFormat(t),o=A.toHumanFriendlyFormat(e);return"".concat(n,"/").concat(o)},isUploadFinished:function(t){return t.status===$},isUploadAbort:function(t){return t.status===P}}},q=(n("4a28"),n("8336")),H=n("b0af"),K=n("99d9"),N=n("169a"),W=n("8270"),G=n("8e36"),z=n("2fa4"),J=Object(u.a)(M,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("input",{ref:"fileInput",staticClass:"hidden-input",attrs:{type:"file",multiple:""}}),t.upload.displayDialog?t._e():n("v-btn",{staticClass:"floating-button",attrs:{color:"pink",dark:"",small:"",absolute:"",bottom:"",right:"",fab:""},on:{click:function(e){t.upload.displayDialog=!0}}},[n("v-icon",[t._v("mdi-water")])],1),n("v-dialog",{attrs:{width:"600",persistent:!0},model:{value:t.upload.displayDialog,callback:function(e){t.$set(t.upload,"displayDialog",e)},expression:"upload.displayDialog"}},[n("v-card",[n("v-card-title",{staticClass:"headline grey lighten-2",attrs:{"primary-title":""}},[t._v(" 文件上传 ")]),0===t.upload.items.length?n("v-card-text",{staticClass:"no-content-text"},[t._v("no content")]):t._e(),n("v-card-text",{staticClass:"no-padding"},[n("v-list",t._l(t.upload.items,(function(e,o){return n("div",{key:o},[n("v-progress-linear",{staticClass:"list-item-progress-bar",attrs:{"background-opacity":"0",color:"rgba(200,200,200,0.4)",height:"45",value:e.uploadProgress}},[n("v-list-item",{key:e.fileName,staticClass:"list-item"},[n("v-list-item-avatar",[n("v-icon",{domProps:{textContent:t._s(e.icon)}})],1),n("v-list-item-content",{staticClass:"list-item-content"},[n("v-list-item-title",{domProps:{innerHTML:t._s(e.fileName)}}),n("v-list-item-subtitle",{domProps:{innerHTML:t._s(e.uploadProgressText)}})],1),n("v-list-item-action",[t.isUploadFinished(e)?n("v-icon",{attrs:{color:"green",dense:!0}},[t._v("mdi-checkbox-marked-circle")]):t._e(),t.isUploadAbort(e)?n("v-icon",{attrs:{color:"red",dense:!0}},[t._v("mdi-alert-circle")]):t._e()],1)],1)],1)],1)})),0)],1),n("v-divider"),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"primary",text:""},on:{click:t.cancel}},[t._v(" Cancel ")]),n("v-btn",{attrs:{color:"primary",text:""},on:{click:function(e){t.upload.displayDialog=!1}}},[t._v(" Hide ")])],1)],1)],1)],1)}),[],!1,null,"8659869c",null),R=J.exports;p()(J,{VBtn:q.a,VCard:H.a,VCardActions:K.a,VCardText:K.b,VCardTitle:K.c,VDialog:N.a,VDivider:f.a,VIcon:h.a,VList:v.a,VListItem:m.a,VListItemAction:w.a,VListItemAvatar:W.a,VListItemContent:g.a,VListItemSubtitle:g.b,VListItemTitle:g.c,VProgressLinear:G.a,VSpacer:z.a});var Q=n("d576"),X={name:"App",components:{ShareList:k,FileUpload:R},data:function(){return{allowUpload:!1}},created:function(){this.initData()},methods:{initData:function(){var t=this;new Promise((function(t,e){s.get("/auth/allow-upload").then((function(n){if(200!==n.status)e(new Error(n.statusText));else{var o=n.data;t(o.allowUpload)}})).catch(e)})).then((function(e){t.allowUpload=e})).catch((function(e){t.$showError(e.message)}))},uploadFile:function(){var t=this.$refs.fileUpload;t.selectFiles().then((function(){t.uploadFiles()}))},copyAllDownloadUrl:function(){var t=this,e=this.$refs.shareList.getAllDownloadUrl();if(e.length>0){var n=e.join("\n");Q.a(n).then((function(){t.$showSuccess("The download link has been copied to the clipboard")}),(function(){t.$showSuccess("Unable to copy the download link to the clipboard")}))}else t.$showWarning("nothing copied")}}},Y=(n("b89c"),n("b0a0"),n("7496")),Z=n("40dc"),tt=n("bb78"),et=n("f6c4"),nt=Object(u.a)(X,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-app",[n("v-app-bar",{attrs:{app:"",color:"primary",dark:""}},[n("v-icon",[t._v("mdi-share-variant")]),n("v-app-bar-title",{staticClass:"app-title"},[t._v("爱分享，我的分享")]),n("v-spacer"),t.allowUpload?n("v-btn",{attrs:{text:""},on:{click:t.uploadFile}},[n("v-icon",[t._v("mdi-cloud-upload")])],1):t._e(),n("v-btn",{attrs:{text:""},on:{click:t.copyAllDownloadUrl}},[n("v-icon",[t._v("mdi-content-copy")])],1)],1),n("v-main",[n("ShareList",{ref:"shareList"}),n("file-upload",{ref:"fileUpload"})],1)],1)}),[],!1,null,"3ea34242",null),ot=nt.exports;p()(nt,{VApp:Y.a,VAppBar:Z.a,VAppBarTitle:tt.a,VBtn:q.a,VIcon:h.a,VMain:et.a,VSpacer:z.a});var at=n("f309");o.a.use(at.a);var rt=new at.a({theme:{themes:{light:{primary:"#3f51b5",secondary:"#b0bec5",accent:"#8c9eff",error:"#b71c1c"}}}}),it={name:"AuthDialog",props:{open:Boolean},data:function(){return{password:""}},methods:{handleCancelButtonClick:function(){this.$emit("cancel")},handleOkButtonClick:function(){this.$emit("ok",this.password)},handleKeyboardEvent:function(t){13!==t.keyCode?27===t.keyCode&&this.handleCancelButtonClick():this.handleOkButtonClick()}}},st=(n("f13f"),n("8654")),lt=Object(u.a)(it,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-dialog",{attrs:{width:"500",persistent:!0},model:{value:t.open,callback:function(e){t.open=e},expression:"open"}},[n("v-card",[n("v-card-title",{staticClass:"headline grey lighten-2",attrs:{"primary-title":""}},[t._v(" 需要密码 ")]),n("v-card-text",{staticClass:"bottom-no-padding"},[n("v-text-field",{attrs:{autofocus:!0,placeholder:"请输入密码"},on:{keyup:t.handleKeyboardEvent},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}})],1),n("v-divider"),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"primary",text:""},on:{click:t.handleCancelButtonClick}},[t._v(" Cancel ")]),n("v-btn",{attrs:{color:"primary",text:""},on:{click:t.handleOkButtonClick}},[t._v(" OK ")])],1)],1)],1)}),[],!1,null,"67579d8a",null),ct=lt.exports;p()(lt,{VBtn:q.a,VCard:H.a,VCardActions:K.a,VCardText:K.b,VCardTitle:K.c,VDialog:N.a,VDivider:f.a,VSpacer:z.a,VTextField:st.a});var ut=o.a.extend(ct),dt={install:function(t,e){t.prototype.$requirePassword=function(){return new Promise((function(t,e){var n=function(){var t=new ut({vuetify:rt});return t.$mount(),document.body.appendChild(t.$el),t}();n.open=!0,n.$on("cancel",(function(){n.open=!1,document.body.removeChild(n.$el),e(new Error("user cancel"))})),n.$on("ok",(function(){n.open=!1,document.body.removeChild(n.$el),t(n.password)}))}))}}},pt={name:"Toast",data:function(){return{display:this.show,text:"",color:"#2196f3",timeout:6e3}},methods:{showMessage:function(t){this.text=t,this.color="#2196f3",this.display=!0},showSuccess:function(t){this.text=t,this.color="#4caf50",this.display=!0},showWarning:function(t){this.text=t,this.color="#ff9800",this.display=!0},showError:function(t){this.text=t,this.color="#f44336",this.display=!0}}},ft=n("2db4"),ht=Object(u.a)(pt,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-snackbar",{attrs:{timeout:t.timeout,color:t.color,top:!0},scopedSlots:t._u([{key:"action",fn:function(e){var o=e.attrs;return[n("v-btn",t._b({attrs:{text:""},on:{click:function(e){t.display=!1}}},"v-btn",o,!1),[t._v(" Close ")])]}}]),model:{value:t.display,callback:function(e){t.display=e},expression:"display"}},[t._v(" "+t._s(t.text)+" ")])}),[],!1,null,"ad883c22",null),vt=ht.exports;p()(ht,{VBtn:q.a,VSnackbar:ft.a});var mt=o.a.extend(vt),wt={install:function(t,e){if(!this.installed){this.installed=!0;var n=function(){var t=new mt({vuetify:rt});return t.$mount(),document.body.appendChild(t.$el),t}();t.prototype.$showMessage=function(t){n.showMessage(t)},t.prototype.$showSuccess=function(t){n.showSuccess(t)},t.prototype.$showWarning=function(t){n.showWarning(t)},t.prototype.$showError=function(t){n.showError(t)}}}};o.a.config.productionTip=!1,o.a.use(dt),o.a.use(wt),new o.a({vuetify:rt,render:function(t){return t(ot)}}).$mount("#app")},"89f0":function(t,e,n){},b0a0:function(t,e,n){"use strict";n("452c")},b89c:function(t,e,n){"use strict";n("89f0")},c713:function(t,e,n){},f13f:function(t,e,n){"use strict";n("c713")}});